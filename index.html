<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <title>Providing Insight into Machine Learning through Visualization</title>
  <style>
    .axis .domain {
      display: none;
    }

    .grid line {
      stroke: lightgrey;
      stroke-opacity: 0.7;
      shape-rendering: crispEdges;
    }

    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 18pt;
    }

    tr {
      font-size: 10pt;
    }

    .main {
      width: 600px;
      margin: 30px auto 0 auto;
    }

    path {
      fill: none;
    }

    path.tree-path {
      stroke: none;
    }

    path.tree-link {
      stroke: gray;
      stroke-width: 1px;
    }

    .tree-results {
      display: block;
    }

    .classifier-base {
      height: 1px;
      fill: #aaaaaa;
      width: 100%;
    }

    rect.leaf {
      width: 2px;
      height: 14px;
      stroke: 2px;
    }

    text.accuracy-label {
      font-size: 12px;
      text-anchor: middle;
    }

    text.accuracy-value {
      font-size: 18px;
      text-anchor: middle;
    }

    .classifier-fraction {
      font-size: 16px;
    }

    .target {
      stroke: #98abc5;
      fill: #98abc5;
    }

    .nontarget {
      stroke: #ff8c00;
      fill: #ff8c00;
    }

    .correct {}

    .incorrect {
      fill: none;
      stroke-width: 1px;
    }

    path.sample-path {
      fill: none;
      visibility: hidden;
    }

    circle.sample:hover+path.sample-path {
      stroke-width: 2px;
      visibility: visible;
    }

    div#buttons {
      margin-left: 20px;
    }

    button {
      padding: 10px 10px;
      font-size: 12px;
      margin: 0 5px;
      border-radius: 20px;
      border: 1px solid #bbb;
      cursor: pointer;
    }

    #container {
      width: 1500px;
      margin: auto;
    }

    .highlight-circle {
      stroke: #31a354;
      stroke-width: 5px;
      visibility: visible;
      fill: none;
    }

    .highlight-path {
      stroke: #31a354;
      visibility: visible;
      fill: none;
    }

    .nodes text {
      pointer-events: none;
      font: 10px sans-serif;
      font-weight: lighter;
    }

    .header{
      margin-left: 40px;
    }

    #info{
      font-weight: lighter;
      font-size: 14px;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      padding-top: 50px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
      font-family: sans-serif;
      background-color: #fefefe;
      margin: auto;
      padding: 20px 20px;
      border: 1px solid #888;
      width: 50%;
      font-weight: lighter;
      line-height: 120%;
      height: 80%;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-body {
      font-size: 14px;
    }

    .legend {
      list-style: none;
      font-size: 14px;
    }
    .legend li {
      float: left;
      margin-right: 10px;
    }
    .legend span {
      border: 1px solid #ccc;
      float: left; width: 12px;
      height: 12px;
      margin: 2px;
    }

    .legend .target {
      background-color: #98abc5;
    }
    .legend .nontarget {
      background-color: #ff8c00;
    }

  </style>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
</head>

<body>
  <div class="header">
    <h1 id="title">Explaining Machine Learning through Visualization</h1>
    <button type="button" data-toggle="modal" data-target="#myModal" style="float:right; margin-right: 1050px">Click here first!</button>
    <p id="info">
      Providing insight into the <a href="http://www.chengli.io/publications/li2016conditional.pdf" target="_blank">CBM model</a>
      and it's classification of the <a href="http://www.uco.es/grupos/kdis/kdiswiki/index.php/Resources" target="_blank">medical dataset</a>.
    </p>
  </div>
  <div>
    <h3 class="header">
      Disease: Class-4-753_0
    </h3>
  </div>

  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <span class="close" data-dismiss="modal" style="float:right">&times;</span>
        <div class="modal-header">
          <h4 class="modal-title">About this project</h4>
        </div>
        <div class="modal-body">
          This project explains a sophisticated machine learning model through simpler visualization techniques. We utilize
          D3.js and React to visualize these components.
        </div>
        <div class="modal-header">
          <h4 class="modal-title">How to Explore the Data</h4>
        </div>
        <div class="modal-body">
          Click "Start Training" to begin training the decision tree. Click "Start Testing" to see how well the tree fits the data set. <br /> <br />
          Click on any node below the tree to see it's symptoms in the node-link visualization. The closer a node is to a symptom,
          the more important that symptom is in determining if that patient is sick.
          This click will also show the node's path through the decision tree. Notice which symptoms the path goes through before reaching
          the bottom of the tree. This helps you understand what symptoms the machine learning model used to decide if the patient
          is diseased or not. <br /> <br />
          Clicking a node also shows that data point's raw output from the CBM model, showing the model's method for predicting
          if a patient has a disease or not. Here, the height of each bar represents how likely each expert thinks the patient has the disease
          labeled on the x-axis. Hovering over each bar shows what symptoms the experts considered when diagnosing the patient. The legend in the corner
          shows the credibility of each expert, and marginal equalling the sum of their three credibilities<br /> <br />
          All the visualizations are connected, so clicking on a node in the decision tree will also highlight it in the node-link, as well as show
          that node's raw output from the CBM.
        </div>
        <div class="modal-header">
          <h4 class="modal-title">Explanation of CBM</h4>
        </div>
        <div class="modal-body">
          To understand how the CBM model makes decisions, see <a href="https://github.com/TaitaiLin/CBMGraph" target="_blank">this demo</a> and
          follow the instructions in the README.
        </div>
        <div class="modal-footer">
        </div>
      </div>
    </div>
  </div>

  <div id="container">
    <div style="padding: 20px">
      <ul class="legend">
        <li><span class="target"></span> not diseased</li>
        <li><span class="nontarget"></span> diseased</li>
    </ul>
    </div>
    <!-- <div id="Class-0-593_70" class="main"></div> -->
    <div id="Class-4-753_0" class="main" style="float:left"></div>
    <!-- <div id="Class-9-599_0" class="main"></div> -->
    <!-- <div id="Class-24-596_54" class="main"></div> -->
    <!-- <div id="Class-31-780_6" class="main"></div> -->
    <!-- <div id="Class-32-486" class="main"></div> -->
    <!-- <div id="Class-36-788_30" class="main"></div> -->
    <!-- <div id="Class-41-591" class="main"></div> -->

    <div style="float:right; margin-top: 20px; margin-bottom: 10px">
      <svg id="bar" width="600" height="300"></svg>
      <svg id="words" width="200" height="200"></svg>
    </div>
  </div>

  <svg id="nodelink" width="800" height="450"></svg>

  <!-- <script src="trees/Class-0-593_70.js"></script> -->
  <script src="trees/Class-4-753_0.js"></script>
  <!-- <script src="trees/Class-9-599_0.js"></script> -->
  <!-- <script src="trees/Class-24-596_54.js"></script> -->
  <!-- <script src="trees/Class-31-780_6.js"></script> -->
  <!-- <script src="trees/Class-32-486.js"></script> -->
  <!-- <script src="trees/Class-36-788_30.js"></script> -->
  <!-- <script src="trees/Class-41-591.js"></script> -->

  <script src="data.js"></script>
  <script src="table.js"></script>
  <script src="bar.js"></script>

  <script src="nodelink.js"></script>

  <script>
    loadData("train", 0);
    drawBars("train", 0);
    document.addEventListener('click', function(e) {
      e = e || window.event;
      var target = e.target || e.srcElement,
        name = target.tagName,
        type = target.getAttribute("id"),
        cL = target.getAttribute("class");
      if (cL == "node") {
        type = parseInt(type.split("-")[1]);
        var nodeNum = type;
        var trainTest = "train";
        if (type > 781) {
          trainTest = "test";
          type -= 782
        }
        var highlightedNodes = document.getElementsByClassName("highlight-circle");
        Array.prototype.forEach.call(highlightedNodes, function(node) {
          node.classList.remove("highlight-circle");
        });
        var circleID = "Class-4-753_0-" + trainTest + "-" + type;
        var circle = document.getElementById(circleID);
        if (circle && circle.classList.contains("highlight-circle")) {
          circle.classList.remove("highlight-circle");
        } else if (circle) {
          circle.classList.add("highlight-circle");
        }
        var pathID = "path-Class-4-753_0-" + trainTest + "-" + type;
        var path = document.getElementById(pathID);
        var highlightedPaths = document.getElementsByClassName("highlight-path");
        var notClicked = path && !path.classList.contains("highlight-path");
        Array.prototype.forEach.call(highlightedPaths, function(hPath) {
          hPath.classList.remove("highlight-path");
          hPath.classList.add("sample-path");
        });
        if (path && path.classList.contains("highlight-path")) {
          path.classList.remove("highlight-path");
          path.classList.add("sample-path");
        } else if (path && notClicked) {
          path.classList.remove("sample-path");
          path.classList.add("highlight-path");
        }
        loadData(trainTest, type);
        drawBars(trainTest, type);
      } else if (name == "circle") {
        var atts = type.split("-");
        var trainTest = atts[atts.length - 2];
        var dataPoint = parseInt(atts[atts.length - 1]);
        var nodeNum = (trainTest == "train") ? dataPoint : dataPoint + 782;

        var highlightedNodes = document.getElementsByClassName("highlight-circle");
        Array.prototype.forEach.call(highlightedNodes, function(node) {
          if (node != target) {
            node.classList.remove("highlight-circle");
          }
        });
        if (target.classList.contains("highlight-circle")) {
          target.classList.remove("highlight-circle");
          unHighlightNode();
        }
        else {
          target.classList.add("highlight-circle");
          highlightNode(nodeNum);
        }
        var highlightedPaths = document.getElementsByClassName("highlight-path");
        Array.prototype.forEach.call(highlightedPaths, function(path) {
          if (path.getAttribute("id") != "path-" + type) {
            path.classList.remove("highlight-path");
            path.classList.add("sample-path");
          }
        });
        var targetPath = document.getElementById("path-" + type);
        if (targetPath.classList.contains("highlight-path")) {
          targetPath.classList.remove("highlight-path");
          targetPath.classList.add("sample-path");
        }
        else {
          targetPath.classList.remove("sample-path");
          targetPath.classList.add("highlight-path");
        }
        loadData(trainTest, dataPoint);
        drawBars(trainTest, dataPoint);
      } else {
        unHighlightNode();
        Array.prototype.forEach.call(document.getElementsByClassName("highlight-circle"), function(node) {
          node.classList.remove("highlight-circle");
        });
        Array.prototype.forEach.call(document.getElementsByClassName("highlight-path"), function(path) {
          path.classList.remove("highlight-path");
          path.classList.add("sample-path");
        });
      }
    }, false);
  </script>
</body>

</html>
